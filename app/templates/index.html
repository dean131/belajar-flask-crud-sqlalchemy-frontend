{% extends 'mainLayout.html' %}

{% block title %}
<title>index</title>
{% endblock %}

{% block body %}
<div class="card">
    <div class="card-body">
        <form method="POST" id="formPost">
            <div class="mb-3">
                <label for="nama" class="form-label">Nama</label>
                <input type="text" class="form-control" name="nama" id="nama">
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" name="email" id="email">
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" name="password" id="password">
            </div>
            <div class="mb-3">
                <label for="alamat" class="form-label">Alamat</label>
                <input type="text" class="form-control" name="alamat" id="alamat">
            </div>
            <label for="rb_kelamin" class="form-label">Jenis kelamin</label>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="j_kelamin" id="rb_kelamin1" value="Laki-laki" checked>
                <label class="form-check-label" for="rb_kelamin1">
                  Laki-laki
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="j_kelamin" id="rb_kelamin2" value="Perempuan">
                <label class="form-check-label" for="rb_kelamin2">
                  Perempuan
                </label>
            </div>
            <div class="mb-3">
                <label for="no_telp" class="form-label"></label>
                <input type="text" class="form-control" name="no_telp" id="no_telp">
            </div>
            <button type="submit" id="btnSubmit" class="btn btn-success">Post</button>
        </form>
    </div>
</div>

<div class="card col-md-auto">
    <div class="card-body col-md-auto">
        <div class="col-md-auto" id="wadah"></div>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    $(document).ready(function() {

        tampil();

        function tampil() {
            $.ajax({
                url: "https://belajar-flask-crud-sqlalchemy.herokuapp.com/users",
                type: "GET",
                dataType: "json",
                success: function(data) {
                    let table = `<table class="table table-striped col-md-auto">
                                <thead> 
                                    <tr>
                                        <th scope="col">ID</th>
                                        <th >Nama</th>
                                        <th >Email</th>
                                        <th >Password</th>
                                        <th >Alamat</th>
                                        <th >J-Kelamin</th>
                                        <th >No Telp</th>
                                        <th >Dibuat</th>
                                    </tr> 
                                </thead> 
                                <tbody> `;
                    $.each(data.values, function() {
                        table += `<tr><td>${this["id"]}</td>`;
                        table += `<td>${this["nama"]}</td>`;
                        table += `<td>${this["email"]}</td>`;
                        table += `<td>${this["password"]}</td>`;
                        table += `<td>${this["alamat"]}</td>`;
                        table += `<td>${this["j_kelamin"]}</td>`;
                        table += `<td>${this["no_telp"]}</td>`;
                        table += `<td>${this["dibuat"]}</td></tr>`;
                    });
                    table += '</tbody> </table>';
                    $("#wadah").html(table)
                }
            });
        }

        $('#formPost').submit(function(event) {
            event.preventDefault();
            $.ajax({
                type: 'POST',
                url: "https://belajar-flask-crud-sqlalchemy.herokuapp.com/users",
                data: $(this).serialize(),
                success: function() {
                    alert('succes post data');
                    tampil();
                }
            });
        });
    });
</script>

{% endblock %}